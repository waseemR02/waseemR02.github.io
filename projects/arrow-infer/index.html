<!doctype html><html class="dark light"><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         arrow_infer
        
    </title><meta content=arrow_infer property=og:title><meta content="ROS2 package for sensor data visualization through Foxglove using Atmega 328p" property=og:description><meta content="ROS2 package for sensor data visualization through Foxglove using Atmega 328p" name=description><link href=https://waseemR02.github.io/fonts.css rel=stylesheet><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Waseem Riaz" href=https://waseemR02.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://waseemR02.github.io/theme/light.css rel=stylesheet><link href=https://waseemR02.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><link href=https://waseemR02.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://waseemR02.github.io>Waseem Riaz</a><div class=socials><a class=social href=https://github.com/waseemr02/ rel=me> <img alt=github src=/social_icons/github.svg> </a><a class=social href=https://www.linkedin.com/in/waseem-riaz rel=me> <img alt=linkedin src=/social_icons/linkedin.svg> </a><a class=social href=mailto:waseem.riaz.9999@gmail.com rel=me> <img alt=email src=/social_icons/email.svg> </a></div></div><nav><a href=/posts style=margin-left:.7em>/posts</a><a href=/projects style=margin-left:.7em>/projects</a><a href=/about style=margin-left:.7em>/about</a> | <a href=javascript:void(0) id=dark-mode-toggle onclick=toggleTheme()> <img id=sun-icon src=/feather/sun.svg style=filter:invert(1)> <img id=moon-icon src=/feather/moon.svg> </a><script src=https://waseemR02.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><div class=page-header>arrow_infer<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta></div></div><section class=body><h1 id=arrow-infer>arrow_infer</h1><p><strong>arrow_infer is a ROS2(foxy) package which uses YOLOv5 detetion model for inferring arrow symbols. It runs the detection model on the host machine running the ROS2 node and publishes the bounding box coordinates with it's inferred class to a topic.</strong><p><em>Requires Python>=3.8 for YOLOv5</em><p><img alt=arrow_infer src=https://user-images.githubusercontent.com/98299006/207795256-e1d45e5c-bc8b-4a6d-a604-081dc4601644.jpg><h2 id=installation>Installation</h2><p>Install the dependencies for <code>YOLOv5</code><pre style=background:#0f1419;color:#bfbab0><code><span>cd arrow_infer
</span><span>pip install -r requirements.txt
</span></code></pre><p><em>Note: Installing in a virtual environment like <code>venv</code> or <code>virtualenv</code> won't work because ros2 runs scripts from native environment even if you running it from a virtual environment shell.</em><p>Build the package<pre style=background:#0f1419;color:#bfbab0><code><span>cd ../../
</span><span>rosdep install -i --from-path src --rosdistro foxy -y
</span><span>colcon build --symlink-install 
</span></code></pre><p><em>Note: Building with <code>--symlink-install</code> is important because there are sub-directories in the package and not just scripts. Running without this argument will only build the scripts and not the sub-directories.</em><h2 id=using-the-package>Using the Package</h2><p>Source the overlay(assuming you have already sourced the underlay)<pre style=background:#0f1419;color:#bfbab0><code><span>source install/setup.bash
</span></code></pre><p>Run the node<pre style=background:#0f1419;color:#bfbab0><code><span>ros2 run arrow_infer yolov5_node
</span></code></pre><p><strong>Things to consider before you run the node</strong><ul><li>The default video feed will taken from /dev/video0<li>The default image size of the video frames is 192x256<li>Place your trained weight in the directory where you are running the node from. Best to keep it in the workspace directory.<li>Name your weight as 'best.pt'.</ul><blockquote><p>The default device can be changed by making changes to the main.py script in the package. Just edit out the source parameter in the __init__ method for the device of your choice.</blockquote><blockquote><p>Same is the case for other defaults.</blockquote><blockquote><p>I might add ros-params feature to the package in the future to make this change dynamic</blockquote><h3 id=topic>Topic</h3><p>The inferred details are published to the /inference topic. When topic is echoed, we get an array as a message of the following format<pre style=background:#0f1419;color:#bfbab0><code><span>| Index of the array |                        Data                              |
</span><span>|:------------------:|----------------------------------------------------------|
</span><span>|0                   | Class number inferred from the weight                    |
</span><span>|1                   | x co-ordinate of top left corner of the bounding box     |
</span><span>|2                   | y co-ordinate of top left corner of the bounding box     |
</span><span>|3                   | x co-ordinate of bottom right corner of the bounding box |
</span><span>|4                   | y co-ordinate of bottom right corner of the bounding box |
</span></code></pre><pre class=language-mermaid data-lang=mermaid style=background:#0f1419;color:#bfbab0><code class=language-mermaid data-lang=mermaid><span>graph TD;
</span><span>    ro1(Array)-->ro(class_no);
</span><span>    ro1-->ro2(x,y of Top Left&LTbr>corner of the&LTbr>Bounding Box);
</span><span>    ro1-->ro3(x,y of Bottom Right&LTbr>corner of the&LTbr>Bounding Box);
</span></code></pre></section></article></main></div>